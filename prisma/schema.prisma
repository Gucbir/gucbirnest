datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id           Int       @id @default(autoincrement())
  fullName     String
  email        String    @unique
  passwordHash String
  role         String    @default("User")
  isActive     Boolean   @default(true)
  department   String?  
  sapUserId Int?
  defaultSapUser   SapUser? @relation("DefaultSapUser", fields: [sapUserId], references: [id])
  
  logs            Log[]

  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
}

model SapUser {
  id           Int      @id @default(autoincrement())
  code         String   @unique
  description  String?
  isActive     Boolean  @default(true)

  defaultOfUsers User[] @relation("DefaultSapUser")
}

model Item {
  id              Int      @id @default(autoincrement())
  ItemCode        String   @unique
  ItemName        String
  ForeignName     String?  

  // SAP Flags (AÅŸÄ±rÄ± kritik)
  ItemType        String   // "I" (Inventory), "L" (Labor), "A" (Service)
  InventoryItem   Boolean  // tYES/tNO â†’ Prisma'da Boolean
  SalesItem       Boolean
  PurchaseItem    Boolean

  // Units of Measure
  InventoryUoM    String?
  SalesUoM        String?
  PurchaseUoM     String?

  // ÃœrÃ¼n grubu
  ItemsGroupCode  Int?     

  // Minimum & Maximum Inventory (SAP OITM: MinInventory, MaxInventory)
  MinInventory    Float?
  MaxInventory    Float?
  QuantityOnStock  Float?   // Toplam mevcut stok miktarÄ±


  // Durumlar
  Valid           Boolean   // tYES/tNO â†’ Boolean
  Frozen          Boolean   // tYES/tNO â†’ Boolean
  AssetItem       Boolean   // tYES/tNO â†’ Boolean (Sabit kÄ±ymet)

  // Fiyat / Kost
  AvgPrice        Float?    // OITM.AvgPrice
  LastPurPrc      Float?    // OITM.LastPurPrc
  LastPurCur      String?   // TRY, USD vs.

  // ðŸ”¥ Ä°LÄ°ÅžKÄ°: Item -> ItemWarehouseStock
  warehouseStocks ItemWarehouseStock[]
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
}


model Warehouse {
  id        Int     @id @default(autoincrement())
  WhsCode   String  @unique   // "R1", "01", "ANA" vs
  WhsName   String
  isActive  Boolean @default(true)
  stocks    ItemWarehouseStock[]
}

model ItemWarehouseStock {
  id          Int        @id @default(autoincrement())

  item        Item       @relation(fields: [itemId], references: [id], onDelete: Cascade)
  itemId      Int

  warehouse   Warehouse  @relation(fields: [warehouseId], references: [id], onDelete: Cascade)
  warehouseId Int

  // HÄ±zlÄ± sorgu iÃ§in kodlarÄ± da saklÄ±yoruz
  ItemCode    String
  WhsCode     String

  InStock     Float      // OITW.OnHand veya InventoryBalances.InStock
  IsCommited  Float?     // istersen ileride doldurursun
  OnOrder     Float?     // istersen ileride doldurursun

  updatedAt   DateTime   @updatedAt

  @@unique([itemId, warehouseId])
  @@index([WhsCode])
  @@index([ItemCode])
}

model Log {
  id        Int      @id @default(autoincrement())
  path      String
  message   String
  userId    Int

  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())
}

model Setting {
id Int @id @default(autoincrement())
name String @unique
settings Json

createdAt DateTime @default(now())
}

model Form {
id Int @id @default(autoincrement())
name String @unique
values Json

createdAt DateTime @default(now())
updatedAt   DateTime   @updatedAt

}